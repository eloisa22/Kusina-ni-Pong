<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kusina ni Daddy Pong</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Rubik:ital,wght@0,300..900;1,300..900&family=Tapestry&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Rubik', sans-serif; background: linear-gradient(black, white); padding: 10px; display: flex; justify-content: center; min-height: 100vh; margin: 0; }
        .container { background: white; width: 100%; max-width: 700px; border-radius: 15px; box-shadow: 0 2px 2px 5px #FFD150; overflow: hidden; height: fit-content; margin-top: 20px;}
        .header { background: #d63031; color: #FFD150; padding: 20px; text-align: center; }
        .logo { width: 150px; height: auto; margin-bottom: 10px; border-radius: 50%; padding: 5px; }
        .header h1 { margin: 0; font-family: "Tapestry", serif; font-size: 36px; font-weight: 400; }

        .form { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; border-bottom: 2px solid #f0f2f5; }
        .full-width { grid-column: span 2; }
        
        /* Layout fixed: Product is wider, Qty is smaller */
        .prod-col { grid-column: span 1; width: 135%; }
        .qty-col { grid-column: span 1; width: 60%; justify-self: end; }

        label { font-size: 12px; font-weight: 700; color: #636e72; text-transform: uppercase; margin-bottom: 5px; display: block; }
        input, select { font-family: 'Rubik', sans-serif; width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 10px; font-size: 18px; box-sizing: border-box; color: #2d3436; }
        
        #errorMsg { color: #d63031; font-size: 13px; font-weight: bold; margin-top: 5px; display: none; }

        .btn-group { padding: 0 20px 20px; display: flex; gap: 10px; }
        button { font-family: 'Rubik', sans-serif; flex: 1; padding: 15px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; color: white; text-transform: uppercase; font-size: 14px; transition: 0.2s; }
        .btn-add { background: #d63031; box-shadow: 0 4px #b02626; }
        .btn-add:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; opacity: 0.7; }
        .btn-excel { background: #27ae60; box-shadow: 0 4px #1e8449; }
        
        .del-btn { background: none; border: none; color: #d63031; cursor: pointer; font-size: 18px; padding: 0; }

        .table-area { padding: 10px; max-height: 500px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 12px; border-bottom: 2px solid #eee; padding: 10px; color: #b2bec3; }
        td { padding: 12px 10px; border-bottom: 1px solid #f1f2f6; font-size: 15px; color: #2d3436; }
        
        .total-section { padding: 20px; text-align: right; background: #f9f9f9; font-size: 24px; font-weight: 900; color: #d63031; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="logo.png" alt="Logo" class="logo">
        <h1>Kusina ni Daddy Pong</h1>
    </div>
    
    <div class="form">
        <div class="full-width">
            <label>Buyer's Name</label>
            <input type="text" id="buyerName" placeholder="Enter Name">
        </div>
        <div class="prod-col">
            <label>Product</label>
            <select id="prod">
                <option value="160">Chicken Pastil (Spicy) - ‚Ç±160</option>
                <option value="150">Chicken Pastil (Original) - ‚Ç±150</option>
                <option value="170">Kinamatisang Dilis - ‚Ç±170</option>
                <option value="180">Pork Binagoongan (S&S) - ‚Ç±180</option>
                <option value="180">Pork Binagoongan (Sweet) - ‚Ç±180</option>
                <option value="160">Chicken Roll (Ham) - ‚Ç±160</option>
                <option value="160">Chicken Roll (Hotdog) - ‚Ç±160</option>
                <option value="180">Pork Humba - ‚Ç±180</option>
            </select>
        </div>
        <div class="qty-col">
            <label>Qty</label>
            <input type="number" id="qty" value="1" min="1">
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-add" id="addBtn" disabled>ADD ENTRY</button>
        <button class="btn-excel" id="excelBtn">DOWNLOAD EXCEL</button>
    </div>

    <div class="table-area">
        <table id="orderTable">
            <thead>
                <tr><th>Name</th><th>Item</th><th>Qty</th><th>Total</th><th></th></tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
    <div class="total-section">
        Grand Total: ‚Ç±<span id="grandDisplay">0</span>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDA_Xr94im77KKizIz5IBB3FeGweCP1Egc",
    authDomain: "food-admin2.firebaseapp.com",
    databaseURL: "https://food-admin2-default-rtdb.firebaseio.com",
    projectId: "food-admin2",
    storageBucket: "food-admin2.firebasestorage.app",
    messagingSenderId: "1007400386429",
    appId: "1:1007400386429:web:2778b245d782f72ec3d614"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const ordersRef = ref(db, 'orders');

  const addBtn = document.getElementById('addBtn');
  const excelBtn = document.getElementById('excelBtn');
  const buyerInput = document.getElementById('buyerName');

  const PASS = "Bukatot@18";

  // Fixed validation: enables when you type
  buyerInput.addEventListener('input', () => {
      addBtn.disabled = buyerInput.value.trim().length === 0;
  });

  // NO PASSWORD to add (easier for you)
  addBtn.addEventListener('click', () => {
      const name = buyerInput.value.trim();
      const prodSelect = document.getElementById('prod');
      const itemName = prodSelect.options[prodSelect.selectedIndex].text.split(' - ')[0];
      const price = parseInt(prodSelect.value);
      const quantity = parseInt(document.getElementById('qty').value);
      
      const newOrder = {
          name: name,
          item: itemName,
          qty: quantity,
          total: price * quantity,
          timestamp: new Date().toLocaleString()
      };

      push(ordersRef, newOrder);
      buyerInput.value = "";
      addBtn.disabled = true;
  });

  onValue(ordersRef, (snapshot) => {
      const data = snapshot.val();
      const tbody = document.getElementById('tbody');
      let grandTotal = 0;
      tbody.innerHTML = "";

      if (data) {
          Object.entries(data).reverse().forEach(([key, order]) => {
              grandTotal += order.total;
              const row = `<tr>
                  <td>${order.name}</td>
                  <td><b>${order.item}</b></td>
                  <td>${order.qty}</td>
                  <td>‚Ç±${order.total.toLocaleString()}</td>
                  <td><button class="del-btn" data-id="${key}">üóëÔ∏è</button></td>
              </tr>`;
              tbody.innerHTML += row;
          });

          // Password ONLY to delete
          document.querySelectorAll('.del-btn').forEach(btn => {
              btn.onclick = () => {
                  const pass = prompt("Password to delete:");
                  if (pass === PASS) {
                      remove(ref(db, 'orders/' + btn.getAttribute('data-id')));
                  } else {
                      alert("Wrong Password");
                  }
              };
          });
      }
      document.getElementById('grandDisplay').innerText = grandTotal.toLocaleString();
  });

  // Keep original excel logic
  excelBtn.addEventListener('click', () => {
      onValue(ordersRef, (snapshot) => {
          const data = snapshot.val();
          if(!data) return alert("No data yet!");
          let csv = "Date,Buyer Name,Product,Quantity,Total\n";
          Object.values(data).forEach(o => {
              csv += `"${o.timestamp}","${o.name}","${o.item}",${o.qty},${o.total}\n`;
          });
          const blob = new Blob([csv], { type: 'text/csv' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = "Kusina_Daddy_Pong_Sales.csv";
          a.click();
      }, { onlyOnce: true });
  });
</script>

</body>
</html>
